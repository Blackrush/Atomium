package org.atomium.metadata;

import com.google.common.reflect.TypeToken;
import org.atomium.Ref;
import org.atomium.SimpleRef;

import static com.google.common.base.Preconditions.checkNotNull;

/**
 * @author Blackrush
 */
public abstract class ColumnMetadata<T> {
    private final Metadata<T> parent;
    private final String name;

    public ColumnMetadata(Metadata<T> parent, String name) {
        this.parent = checkNotNull(parent);
        this.name = checkNotNull(name);
    }

    /**
     * get the {@link Metadata} that owns this column
     * @return the non-null parent
     */
    public Metadata<T> getParent() {
        return parent;
    }

    /**
     * returns <code>true</code> if this column is a primary key, <code>false</code> otherwise
     * @return <code>true</code> if this column is a primary key, <code>false</code> otherwise
     */
    public abstract boolean isPrimaryKey();

    /**
     * returns <code>true</code> if this column is autogenerated, <code>false</code> otherwise
     * @return <code>true</code> if this column is autogenerated, <code>false</code> otherwise
     */
    public abstract boolean isAutogenerated();

    /**
     * returns <code>true</code> if this column is nullable, <code>false</code> otherwise
     * @return <code>true</code> if this column is nullable, <code>false</code> otherwise
     */
    public abstract boolean isNullable();

    /**
     * get the {@link org.atomium.metadata.MetadataRegistry} that contains this column's parent
     * @return the non-null parent's registry
     */
    public MetadataRegistry getRegistry() {
        return parent.getRegistry();
    }

    /**
     * get this column's name
     * @return the non-null name
     */
    public String getName() {
        return name;
    }

    public abstract TypeToken<?> getTarget();

    public ConverterInterface getConverter() {
        return getRegistry().getConverterFor(getTarget());
    }

    public abstract void load();

    public abstract Object get(T entity);
    public abstract void set(T entity, Object o);

    public Ref<T> getRef(Object identifier) {
        return new SimpleRef<>(this, identifier);
    }
}
